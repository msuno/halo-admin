(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-528a0184"],{3993:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-drawer",{attrs:{title:t.title,width:t.isMobile()?"100%":t.drawerWidth,closable:"",visible:t.visible,destroyOnClose:""},on:{close:t.onClose}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-input-search",{attrs:{placeholder:"搜索附件",enterButton:""},on:{search:function(e){return t.handleQuery()}},model:{value:t.queryParam.keyword,callback:function(e){t.$set(t.queryParam,"keyword",e)},expression:"queryParam.keyword"}})],1),a("a-divider"),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-skeleton",{attrs:{active:"",loading:t.skeletonLoading,paragraph:{rows:18}}},[a("a-col",{attrs:{span:24}},[0==t.attachments.length?a("a-empty"):t._l(t.attachments,(function(e,n){return a("div",{key:n,staticClass:"attach-item",on:{click:function(a){return t.handleSelectAttachment(e)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!t.handleJudgeMediaType(e),expression:"!handleJudgeMediaType(item)"}]},[t._v("当前格式不支持预览")]),a("img",{directives:[{name:"show",rawName:"v-show",value:t.handleJudgeMediaType(e),expression:"handleJudgeMediaType(item)"}],attrs:{src:e.thumbPath,loading:"lazy"}})])}))],2)],1)],1),a("a-divider"),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:t.pagination.page,total:t.pagination.total,defaultPageSize:t.pagination.size},on:{change:t.handlePaginationChange}})],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[t.isChooseAvatar?a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"},on:{click:t.handleSelectGravatar}},[t._v("使用 Gravatar")]):t._e(),a("a-button",{attrs:{type:"primary"},on:{click:t.handleShowUploadModal}},[t._v("上传附件")])],1)],1),a("a-modal",{attrs:{title:"上传附件",footer:null,afterClose:t.onUploadClose,destroyOnClose:""},model:{value:t.uploadVisible,callback:function(e){t.uploadVisible=e},expression:"uploadVisible"}},[a("FilePondUpload",{ref:"upload",attrs:{uploadHandler:t.uploadHandler}})],1)],1)},o=[],r=(a("9a33"),a("c904"),a("163d"),a("ac0d")),i=a("a796"),l={name:"AttachmentSelectDrawer",mixins:[r["a"],r["b"]],model:{prop:"visible",event:"close"},props:{visible:{type:Boolean,required:!1,default:!1},drawerWidth:{type:Number,required:!1,default:480},title:{type:String,required:!1,default:"选择附件"},isChooseAvatar:{type:Boolean,required:!1,default:!1}},data:function(){return{uploadVisible:!1,skeletonLoading:!0,pagination:{page:1,size:12,sort:null,total:1},queryParam:{page:0,size:12,sort:null,keyword:null},attachments:[],uploadHandler:i["a"].upload}},watch:{visible:function(t,e){t&&(this.loadSkeleton(),this.loadAttachments())}},methods:{loadSkeleton:function(){var t=this;this.skeletonLoading=!0,setTimeout((function(){t.skeletonLoading=!1}),500)},handleShowUploadModal:function(){this.uploadVisible=!0},loadAttachments:function(){var t=this;this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,i["a"].query(this.queryParam).then((function(e){t.attachments=e.data.data.content,t.pagination.total=e.data.data.total}))},handleQuery:function(){this.handlePaginationChange(1,this.pagination.size)},handleSelectAttachment:function(t){this.$emit("listenToSelect",t)},handleSelectGravatar:function(){this.$emit("listenToSelectGravatar")},handlePaginationChange:function(t,e){this.pagination.page=t,this.pagination.size=e,this.loadAttachments()},onUploadClose:function(){this.$refs.upload.handleClearFileList(),this.loadSkeleton(),this.handlePaginationChange(1,this.pagination.size)},handleJudgeMediaType:function(t){var e=t.mediaType;if(e){var a=e.split("/")[0];return"image"===a}return!1},onClose:function(){this.$emit("close",!1)}}},s=l,d=a("9ca4"),c=Object(d["a"])(s,n,o,!1,null,null,null);e["a"]=c.exports},a796:function(t,e,a){"use strict";a("f548"),a("cc57"),a("b449");var n=a("85ff"),o=a("82ae"),r=a.n(o),i=a("9efd"),l="/api/admin/attachments",s={query:function(t){return Object(i["a"])({url:l,params:t,method:"get"})},get:function(t){return Object(i["a"])({url:"".concat(l,"/").concat(t),method:"get"})},delete:function(t){return Object(i["a"])({url:"".concat(l,"/").concat(t),method:"delete"})},deleteInBatch:function(t){return Object(i["a"])({url:"".concat(l),method:"delete",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})},update:function(t,e){return Object(i["a"])({url:"".concat(l,"/").concat(t),method:"put",data:e})},getMediaTypes:function(){return Object(i["a"])({url:"".concat(l,"/media_types"),method:"get"})},getTypes:function(){return Object(i["a"])({url:"".concat(l,"/types"),method:"get"})}};s.CancelToken=r.a.CancelToken,s.isCancel=r.a.isCancel,s.upload=function(t,e,a,n,o,r){return r===s.type.QINIUOSS.type?s.ossQinUpload(t,e,a,o):r===s.type.TENCENTCOS.type?s.ossTenUpload(e,a,o):Object(i["a"])({url:"".concat(l,"/upload"),timeout:864e4,data:t,onUploadProgress:e,cancelToken:a,method:"post"})},s.uploads=function(t,e,a){return Object(i["a"])({url:"".concat(l,"/uploads"),timeout:864e4,data:t,onUploadProgress:e,cancelToken:a,method:"post"})},s.ossQinUpload=function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,a,n,o){var d,c,u,p,h,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["a"])({url:"".concat(l,"/token"),method:"post"});case 2:return d=t.sent,c=d.data.data.token,u=d.data.data.basePath,p=o.name,e.append("name",p),e.append("key",u+p),e.append("token",c),h=r.a.create(),t.next=12,h({url:"http://upload-z2.qiniup.com",data:e,method:"post",onUploadProgress:a,cancelToken:n});case 12:return m=t.sent,m.data.suffix=m.data.suffix?m.data.suffix.replace(".",""):m.data.suffix,t.abrupt("return",s.saveUpload(m.data));case 15:case"end":return t.stop()}}),t)})));return function(e,a,n,o){return t.apply(this,arguments)}}(),s.ossTenUpload=function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,a,n){var o,d,c,u,p,h,m,g,f,b,y;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["a"])({url:"".concat(l,"/token"),method:"post"});case 2:return o=t.sent,d=n.name,c=o.data.data.basePath,u=o.data.data.host,p=new FormData,h=c+d,p.append("key",h),p.append("policy",o.data.data["policy"]),p.append("q-sign-algorithm",o.data.data["q-sign-algorithm"]),p.append("q-ak",o.data.data["q-ak"]),p.append("q-key-time",o.data.data["q-key-time"]),p.append("q-signature",o.data.data["q-signature"]),p.append("file",n),m=r.a.create(),t.next=18,m({url:u,data:p,method:"post",onUploadProgress:e,cancelToken:a,headers:{"Content-Type":"multipart/form-data"}});case 18:if(g=t.sent,f=d.lastIndexOf("."),b="png",f>0&&(b=d.substr(f+1)),204!==g.status){t.next=27;break}return y={filename:d,filePath:u+h,key:h,thumbPath:"",suffix:b,mediaType:n.type,size:n.size,width:0,height:0},t.abrupt("return",s.saveUpload(y));case 27:return t.abrupt("return",new Promise(g.data));case 28:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),s.saveUpload=function(t){var e=new FormData;for(var a in"number"!==typeof t.width&&(t.width=0),"number"!==typeof t.height&&(t.height=0),t)e.append(a,t[a]);return Object(i["a"])({url:"".concat(l,"/save"),data:e,method:"post"})},s.type={LOCAL:{type:"LOCAL",text:"本地"},SMMS:{type:"SMMS",text:"SM.MS"},UPOSS:{type:"UPOSS",text:"又拍云"},QINIUOSS:{type:"QINIUOSS",text:"七牛云"},ALIOSS:{type:"ALIOSS",text:"阿里云"},BAIDUBOS:{type:"BAIDUBOS",text:"百度云"},TENCENTCOS:{type:"TENCENTCOS",text:"腾讯云"},HUAWEIOBS:{type:"HUAWEIOBS",text:"华为云"}},e["a"]=s},aa1e:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-row",{attrs:{gutter:12}},[a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:10,lg:10,md:10,sm:24,xs:24}},[a("a-card",{attrs:{title:t.title,bodyStyle:{padding:"16px"}}},[a("a-form-model",{ref:"tagForm",attrs:{model:t.tagToCreate,rules:t.tagRules,layout:"horizontal"}},[a("a-form-model-item",{attrs:{label:"名称：",help:"* 页面上所显示的名称",prop:"name"}},[a("a-input",{model:{value:t.tagToCreate.name,callback:function(e){t.$set(t.tagToCreate,"name",e)},expression:"tagToCreate.name"}})],1),a("a-form-model-item",{attrs:{label:"别名：",help:"* 一般为单个标签页面的标识，最好为英文",prop:"slug"}},[a("a-input",{model:{value:t.tagToCreate.slug,callback:function(e){t.$set(t.tagToCreate,"slug",e)},expression:"tagToCreate.slug"}})],1),a("a-form-model-item",{attrs:{label:"封面图：",help:"* 在标签页面可展示，需要主题支持",prop:"thumbnail"}},[a("a-input",{model:{value:t.tagToCreate.thumbnail,callback:function(e){t.$set(t.tagToCreate,"thumbnail",e)},expression:"tagToCreate.thumbnail"}},[a("a",{attrs:{slot:"addonAfter",href:"javascript:void(0);"},on:{click:function(e){t.thumbnailDrawerVisible=!0}},slot:"addonAfter"},[a("a-icon",{attrs:{type:"picture"}})],1)])],1),a("a-form-model-item",[t.isUpdateForm?a("a-button-group",[a("a-button",{attrs:{type:"primary"},on:{click:t.handleSaveClick}},[t._v("更新")]),a("a-button",{attrs:{type:"dashed"},on:{click:function(e){t.tagToCreate={}}}},[t._v("返回添加")])],1):a("a-button",{attrs:{type:"primary"},on:{click:t.handleSaveClick}},[t._v("保存")]),t.isUpdateForm?a("a-popconfirm",{attrs:{title:"你确定要删除【"+t.tagToCreate.name+"】标签？",okText:"确定",cancelText:"取消"},on:{confirm:function(e){return t.handleDeleteTag(t.tagToCreate.id)}}},[a("a-button",{staticStyle:{float:"right"},attrs:{type:"danger"}},[t._v("删除")])],1):t._e()],1)],1)],1)],1),a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:14,lg:14,md:14,sm:24,xs:24}},[a("a-card",{attrs:{title:"所有标签",bodyStyle:{padding:"16px"}}},[0==t.tags.length?a("a-empty"):t._l(t.tags,(function(e){return a("a-tooltip",{key:e.id,attrs:{placement:"topLeft"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.postCount)+" 篇文章")])]),a("a-tag",{staticStyle:{"margin-bottom":"8px",cursor:"pointer"},attrs:{color:"blue"},on:{click:function(a){return t.handleEditTag(e)}}},[t._v(t._s(e.name))])],2)}))],2)],1)],1),a("AttachmentSelectDrawer",{attrs:{title:"选择封面图"},on:{listenToSelect:t.handleSelectThumbnail},model:{value:t.thumbnailDrawerVisible,callback:function(e){t.thumbnailDrawerVisible=e},expression:"thumbnailDrawerVisible"}})],1)},o=[],r=a("d28d"),i=a("3993"),l={components:{AttachmentSelectDrawer:i["a"]},data:function(){return{tags:[],tagToCreate:{},thumbnailDrawerVisible:!1,tagRules:{name:[{required:!0,message:"* 标签名称不能为空",trigger:["change","blur"]},{max:255,message:"* 标签名称的字符长度不能超过 255",trigger:["change","blur"]}],slug:[{max:255,message:"* 标签别名的字符长度不能超过 255",trigger:["change","blur"]}],thumbnail:[{max:1023,message:"* 封面图链接的字符长度不能超过 1023",trigger:["change","blur"]}]}}},computed:{title:function(){return this.tagToCreate.id?"修改标签":"添加标签"},isUpdateForm:function(){return this.tagToCreate.id}},created:function(){this.loadTags()},methods:{loadTags:function(){var t=this;r["a"].listAll(!0).then((function(e){t.tags=e.data.data}))},handleSaveClick:function(){this.createOrUpdateTag()},handleEditTag:function(t){this.tagToCreate=t},handleDeleteTag:function(t){var e=this;r["a"].delete(t).then((function(t){e.$message.success("删除成功！"),e.tagToCreate={}})).finally((function(){e.loadTags()}))},createOrUpdateTag:function(){var t=this;this.$refs.tagForm.validate((function(e){e&&(t.tagToCreate.id?r["a"].update(t.tagToCreate.id,t.tagToCreate).then((function(e){t.$message.success("更新成功！"),t.tagToCreate={}})):r["a"].create(t.tagToCreate).then((function(e){t.$message.success("保存成功！"),t.tagToCreate={}})).finally((function(){t.loadTags()})))}))},handleSelectThumbnail:function(t){this.$set(this.tagToCreate,"thumbnail",encodeURI(t.path)),this.thumbnailDrawerVisible=!1}}},s=l,d=a("9ca4"),c=Object(d["a"])(s,n,o,!1,null,null,null);e["default"]=c.exports},d28d:function(t,e,a){"use strict";var n=a("9efd"),o="/api/admin/tags",r={listAll:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(n["a"])({url:o,params:{more:t},method:"get"})},createWithName:function(t){return Object(n["a"])({url:o,data:{name:t},method:"post"})},create:function(t){return Object(n["a"])({url:o,data:t,method:"post"})},update:function(t,e){return Object(n["a"])({url:"".concat(o,"/").concat(t),data:e,method:"put"})},delete:function(t){return Object(n["a"])({url:"".concat(o,"/").concat(t),method:"delete"})}};e["a"]=r}}]);