(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-068aa3f1"],{"1f27":function(e,t,a){"use strict";var n=a("9efd"),r="/api/admin/menus",o={listAll:function(){return Object(n["a"])({url:r,method:"get"})},listTree:function(){return Object(n["a"])({url:"".concat(r,"/tree_view"),method:"get"})},create:function(e){return Object(n["a"])({url:r,data:e,method:"post"})},delete:function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"delete"})},get:function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"get"})},update:function(e,t){return Object(n["a"])({url:"".concat(r,"/").concat(e),data:t,method:"put"})},listTeams:function(){return Object(n["a"])({url:"".concat(r,"/teams"),method:"get"})}};t["a"]=o},3993:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-drawer",{attrs:{title:e.title,width:e.isMobile()?"100%":e.drawerWidth,closable:"",visible:e.visible,destroyOnClose:""},on:{close:e.onClose}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-input-search",{attrs:{placeholder:"搜索附件",enterButton:""},on:{search:function(t){return e.handleQuery()}},model:{value:e.queryParam.keyword,callback:function(t){e.$set(e.queryParam,"keyword",t)},expression:"queryParam.keyword"}})],1),a("a-divider"),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-skeleton",{attrs:{active:"",loading:e.skeletonLoading,paragraph:{rows:18}}},[a("a-col",{attrs:{span:24}},[0==e.attachments.length?a("a-empty"):e._l(e.attachments,(function(t,n){return a("div",{key:n,staticClass:"attach-item",on:{click:function(a){return e.handleSelectAttachment(t)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!e.handleJudgeMediaType(t),expression:"!handleJudgeMediaType(item)"}]},[e._v("当前格式不支持预览")]),a("img",{directives:[{name:"show",rawName:"v-show",value:e.handleJudgeMediaType(t),expression:"handleJudgeMediaType(item)"}],attrs:{src:t.thumbPath,loading:"lazy"}})])}))],2)],1)],1),a("a-divider"),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:e.pagination.page,total:e.pagination.total,defaultPageSize:e.pagination.size},on:{change:e.handlePaginationChange}})],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[e.isChooseAvatar?a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"},on:{click:e.handleSelectGravatar}},[e._v("使用 Gravatar")]):e._e(),a("a-button",{attrs:{type:"primary"},on:{click:e.handleShowUploadModal}},[e._v("上传附件")])],1)],1),a("a-modal",{attrs:{title:"上传附件",footer:null,afterClose:e.onUploadClose,destroyOnClose:""},model:{value:e.uploadVisible,callback:function(t){e.uploadVisible=t},expression:"uploadVisible"}},[a("FilePondUpload",{ref:"upload",attrs:{uploadHandler:e.uploadHandler}})],1)],1)},r=[],o=(a("9a33"),a("c904"),a("163d"),a("ac0d")),i=a("a796"),l={name:"AttachmentSelectDrawer",mixins:[o["a"],o["b"]],model:{prop:"visible",event:"close"},props:{visible:{type:Boolean,required:!1,default:!1},drawerWidth:{type:Number,required:!1,default:480},title:{type:String,required:!1,default:"选择附件"},isChooseAvatar:{type:Boolean,required:!1,default:!1}},data:function(){return{uploadVisible:!1,skeletonLoading:!0,pagination:{page:1,size:12,sort:null,total:1},queryParam:{page:0,size:12,sort:null,keyword:null},attachments:[],uploadHandler:i["a"].upload}},watch:{visible:function(e,t){e&&(this.loadSkeleton(),this.loadAttachments())}},methods:{loadSkeleton:function(){var e=this;this.skeletonLoading=!0,setTimeout((function(){e.skeletonLoading=!1}),500)},handleShowUploadModal:function(){this.uploadVisible=!0},loadAttachments:function(){var e=this;this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,i["a"].query(this.queryParam).then((function(t){e.attachments=t.data.data.content,e.pagination.total=t.data.data.total}))},handleQuery:function(){this.handlePaginationChange(1,this.pagination.size)},handleSelectAttachment:function(e){this.$emit("listenToSelect",e)},handleSelectGravatar:function(){this.$emit("listenToSelectGravatar")},handlePaginationChange:function(e,t){this.pagination.page=e,this.pagination.size=t,this.loadAttachments()},onUploadClose:function(){this.$refs.upload.handleClearFileList(),this.loadSkeleton(),this.handlePaginationChange(1,this.pagination.size)},handleJudgeMediaType:function(e){var t=e.mediaType;if(t){var a=t.split("/")[0];return"image"===a}return!1},onClose:function(){this.$emit("close",!1)}}},c=l,s=a("9ca4"),u=Object(s["a"])(c,n,r,!1,null,null,null);t["a"]=u.exports},"7e89":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-row",{attrs:{gutter:12}},[a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:10,lg:10,md:10,sm:24,xs:24}},[a("a-card",{attrs:{title:e.title,bodyStyle:{padding:"16px"}}},[a("a-form-model",{ref:"categoryForm",attrs:{model:e.categoryToCreate,rules:e.categoryRules,layout:"horizontal"}},[a("a-form-model-item",{attrs:{label:"名称：",help:"* 页面上所显示的名称",prop:"name"}},[a("a-input",{model:{value:e.categoryToCreate.name,callback:function(t){e.$set(e.categoryToCreate,"name",t)},expression:"categoryToCreate.name"}})],1),a("a-form-model-item",{attrs:{label:"别名：",help:"* 一般为单个分类页面的标识，最好为英文",prop:"slug"}},[a("a-input",{model:{value:e.categoryToCreate.slug,callback:function(t){e.$set(e.categoryToCreate,"slug",t)},expression:"categoryToCreate.slug"}})],1),a("a-form-model-item",{attrs:{label:"上级目录：",prop:"parentId"}},[a("category-select-tree",{attrs:{categories:e.categories},model:{value:e.categoryToCreate.parentId,callback:function(t){e.$set(e.categoryToCreate,"parentId",t)},expression:"categoryToCreate.parentId"}})],1),a("a-form-model-item",{attrs:{label:"封面图：",help:"* 在分类页面可展示，需要主题支持",prop:"thumbnail"}},[a("a-input",{model:{value:e.categoryToCreate.thumbnail,callback:function(t){e.$set(e.categoryToCreate,"thumbnail",t)},expression:"categoryToCreate.thumbnail"}},[a("a",{attrs:{slot:"addonAfter",href:"javascript:void(0);"},on:{click:function(t){e.thumbnailDrawerVisible=!0}},slot:"addonAfter"},[a("a-icon",{attrs:{type:"picture"}})],1)])],1),a("a-form-model-item",{attrs:{label:"描述：",help:"* 分类描述，部分主题可显示",prop:"description"}},[a("a-input",{attrs:{type:"textarea",autoSize:{minRows:3}},model:{value:e.categoryToCreate.description,callback:function(t){e.$set(e.categoryToCreate,"description",t)},expression:"categoryToCreate.description"}})],1),a("a-form-model-item",[e.isUpdateForm?a("a-button-group",[a("a-button",{attrs:{type:"primary"},on:{click:e.handleSaveClick}},[e._v("更新")]),a("a-button",{attrs:{type:"dashed"},on:{click:function(t){e.categoryToCreate={}}}},[e._v("返回添加")])],1):a("a-button",{attrs:{type:"primary"},on:{click:e.handleSaveClick}},[e._v("保存")])],1)],1)],1)],1),a("a-col",{style:{"padding-bottom":"1rem"},attrs:{xl:14,lg:14,md:14,sm:24,xs:24}},[a("a-card",{attrs:{title:"分类列表",bodyStyle:{padding:"16px"}}},[e.isMobile()?a("a-list",{attrs:{itemLayout:"vertical",size:"large",pagination:!1,dataSource:e.categories,loading:e.loading},scopedSlots:e._u([{key:"renderItem",fn:function(t,n){return a("a-list-item",{key:n},[a("template",{slot:"actions"},[a("span",[a("a-icon",{attrs:{type:"form"}}),e._v(" "+e._s(t.postCount)+" ")],1),a("a-dropdown",{attrs:{placement:"topLeft",trigger:["click"]}},[a("span",[a("a-icon",{attrs:{type:"bars"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(a){return e.handleEditCategory(t)}}},[e._v("编辑")])]),a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要添加【"+t.name+"】到菜单？",okText:"确定",cancelText:"取消"},on:{confirm:function(a){return e.handleCategoryToMenu(t)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("添加到菜单")])])],1),a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要删除【"+t.name+"】分类？",okText:"确定",cancelText:"取消"},on:{confirm:function(a){return e.handleDeleteCategory(t.id)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])],1)],1)],1)],1),a("a-list-item-meta",[a("template",{slot:"description"},[e._v(" "+e._s(t.slug)+" ")]),a("span",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(t.name)+" ")])],2),a("span",[e._v(" "+e._s(t.description)+" ")])],2)}}],null,!1,1898096210)}):a("a-table",{attrs:{columns:e.columns,dataSource:e.categories,rowKey:function(e){return e.id},loading:e.loading,scrollToFirstRowOnChange:!0},scopedSlots:e._u([{key:"postCount",fn:function(t,n){return a("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.handleQueryCategoryPosts(n)}}},[a("a-badge",{attrs:{count:n.postCount,numberStyle:{backgroundColor:"#00e0ff"},showZero:!0,overflowCount:9999}})],1)}},{key:"action",fn:function(t,n){return a("span",{},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleEditCategory(n)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",{staticClass:"ant-dropdown-link",attrs:{href:"javascript:void(0);"}},[e._v("更多")]),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{key:"1"},[a("a-popconfirm",{attrs:{title:"你确定要添加【"+n.name+"】到菜单？",okText:"确定",cancelText:"取消"},on:{confirm:function(t){return e.handleCategoryToMenu(n)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("添加到菜单")])])],1),a("a-menu-item",{key:"2"},[a("a-popconfirm",{attrs:{title:"你确定要删除【"+n.name+"】分类？",okText:"确定",cancelText:"取消"},on:{confirm:function(t){return e.handleDeleteCategory(n.id)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])],1)],1)],1)],1)}}])})],1)],1)],1),a("AttachmentSelectDrawer",{attrs:{title:"选择封面图"},on:{listenToSelect:e.handleSelectThumbnail},model:{value:e.thumbnailDrawerVisible,callback:function(t){e.thumbnailDrawerVisible=t},expression:"thumbnailDrawerVisible"}})],1)},r=[],o=(a("cc57"),a("ac0d")),i=a("fa25"),l=a("3993"),c=a("c405"),s=a("1f27"),u=[{title:"名称",ellipsis:!0,dataIndex:"name"},{title:"别名",ellipsis:!0,dataIndex:"slug"},{title:"描述",ellipsis:!0,dataIndex:"description"},{title:"文章数",dataIndex:"postCount",scopedSlots:{customRender:"postCount"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],d={components:{CategorySelectTree:i["a"],AttachmentSelectDrawer:l["a"]},mixins:[o["a"],o["b"]],data:function(){return{categories:[],categoryToCreate:{},thumbnailDrawerVisible:!1,loading:!1,columns:u,categoryRules:{name:[{required:!0,message:"* 分类名称不能为空",trigger:["change","blur"]},{max:255,message:"* 分类名称的字符长度不能超过 255",trigger:["change","blur"]}],slug:[{max:255,message:"* 分类别名的字符长度不能超过 255",trigger:["change","blur"]}],thumbnail:[{max:1023,message:"* 封面图链接的字符长度不能超过 1023",trigger:["change","blur"]}],description:[{max:100,message:"* 分类描述的字符长度不能超过 100",trigger:["change","blur"]}]}}},computed:{title:function(){return this.categoryToCreate.id?"修改分类":"添加分类"},isUpdateForm:function(){return this.categoryToCreate.id}},created:function(){this.loadCategories()},methods:{loadCategories:function(){var e=this;this.loading=!0,c["a"].listAll(!0).then((function(t){e.categories=t.data.data})).finally((function(){setTimeout((function(){e.loading=!1}),200)}))},handleSaveClick:function(){this.createOrUpdateCategory()},handleEditCategory:function(e){this.categoryToCreate=e},handleDeleteCategory:function(e){var t=this;c["a"].delete(e).then((function(e){t.$message.success("删除成功！"),t.categoryToCreate={}})).finally((function(){t.loadCategories()}))},createOrUpdateCategory:function(){var e=this;this.$refs.categoryForm.validate((function(t){t&&(e.categoryToCreate.id?c["a"].update(e.categoryToCreate.id,e.categoryToCreate).then((function(t){e.$message.success("更新成功！"),e.categoryToCreate={}})).finally((function(){e.loadCategories()})):c["a"].create(e.categoryToCreate).then((function(t){e.$message.success("保存成功！"),e.categoryToCreate={}})).finally((function(){e.loadCategories()})))}))},handleCategoryToMenu:function(e){var t=this,a={name:e.name,url:"".concat(e.fullPath)};s["a"].create(a).then((function(e){t.$message.success("添加到菜单成功！")}))},handleSelectThumbnail:function(e){this.$set(this.categoryToCreate,"thumbnail",encodeURI(e.path)),this.thumbnailDrawerVisible=!1},handleQueryCategoryPosts:function(e){this.$router.push({name:"PostList",query:{categoryId:e.id}})}}},p=d,h=a("9ca4"),m=Object(h["a"])(p,n,r,!1,null,null,null);t["default"]=m.exports},a796:function(e,t,a){"use strict";a("f548"),a("cc57"),a("b449");var n=a("85ff"),r=a("82ae"),o=a.n(r),i=a("9efd"),l="/api/admin/attachments",c={query:function(e){return Object(i["a"])({url:l,params:e,method:"get"})},get:function(e){return Object(i["a"])({url:"".concat(l,"/").concat(e),method:"get"})},delete:function(e){return Object(i["a"])({url:"".concat(l,"/").concat(e),method:"delete"})},deleteInBatch:function(e){return Object(i["a"])({url:"".concat(l),method:"delete",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})},update:function(e,t){return Object(i["a"])({url:"".concat(l,"/").concat(e),method:"put",data:t})},getMediaTypes:function(){return Object(i["a"])({url:"".concat(l,"/media_types"),method:"get"})},getTypes:function(){return Object(i["a"])({url:"".concat(l,"/types"),method:"get"})}};c.CancelToken=o.a.CancelToken,c.isCancel=o.a.isCancel,c.upload=function(e,t,a,n,r,o){return o===c.type.QINIUOSS.type?c.ossQinUpload(e,t,a,r):o===c.type.TENCENTCOS.type?c.ossTenUpload(t,a,r):Object(i["a"])({url:"".concat(l,"/upload"),timeout:864e4,data:e,onUploadProgress:t,cancelToken:a,method:"post"})},c.uploads=function(e,t,a){return Object(i["a"])({url:"".concat(l,"/uploads"),timeout:864e4,data:e,onUploadProgress:t,cancelToken:a,method:"post"})},c.ossQinUpload=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,a,n,r){var s,u,d,p,h,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["a"])({url:"".concat(l,"/token"),method:"post"});case 2:return s=e.sent,u=s.data.data.token,d=s.data.data.basePath,p=r.name,t.append("name",p),t.append("key",d+p),t.append("token",u),h=o.a.create(),e.next=12,h({url:"http://upload-z2.qiniup.com",data:t,method:"post",onUploadProgress:a,cancelToken:n});case 12:return m=e.sent,m.data.suffix=m.data.suffix?m.data.suffix.replace(".",""):m.data.suffix,e.abrupt("return",c.saveUpload(m.data));case 15:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),c.ossTenUpload=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,a,n){var r,s,u,d,p,h,m,g,f,y,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["a"])({url:"".concat(l,"/token"),method:"post"});case 2:return r=e.sent,s=n.name,u=r.data.data.basePath,d=r.data.data.host,p=new FormData,h=u+s,p.append("key",h),p.append("policy",r.data.data["policy"]),p.append("q-sign-algorithm",r.data.data["q-sign-algorithm"]),p.append("q-ak",r.data.data["q-ak"]),p.append("q-key-time",r.data.data["q-key-time"]),p.append("q-signature",r.data.data["q-signature"]),p.append("file",n),m=o.a.create(),e.next=18,m({url:d,data:p,method:"post",onUploadProgress:t,cancelToken:a,headers:{"Content-Type":"multipart/form-data"}});case 18:if(g=e.sent,f=s.lastIndexOf("."),y="png",f>0&&(y=s.substr(f+1)),204!==g.status){e.next=27;break}return b={filename:s,filePath:d+h,key:h,thumbPath:"",suffix:y,mediaType:n.type,size:n.size,width:0,height:0},e.abrupt("return",c.saveUpload(b));case 27:return e.abrupt("return",new Promise(g.data));case 28:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),c.saveUpload=function(e){var t=new FormData;for(var a in"number"!==typeof e.width&&(e.width=0),"number"!==typeof e.height&&(e.height=0),e)t.append(a,e[a]);return Object(i["a"])({url:"".concat(l,"/save"),data:t,method:"post"})},c.type={LOCAL:{type:"LOCAL",text:"本地"},SMMS:{type:"SMMS",text:"SM.MS"},UPOSS:{type:"UPOSS",text:"又拍云"},QINIUOSS:{type:"QINIUOSS",text:"七牛云"},ALIOSS:{type:"ALIOSS",text:"阿里云"},BAIDUBOS:{type:"BAIDUBOS",text:"百度云"},TENCENTCOS:{type:"TENCENTCOS",text:"腾讯云"},HUAWEIOBS:{type:"HUAWEIOBS",text:"华为云"}},t["a"]=c},c405:function(e,t,a){"use strict";a("cc57"),a("6d57");var n=a("9efd"),r="/api/admin/categories",o={};function i(e,t){t.forEach((function(t){e.key===t.parentId&&(e.children||(e.children=[]),e.children.push({key:t.id,title:t.name,isLeaf:!1}))})),e.children?e.children.forEach((function(e){return i(e,t)})):e.isLeaf=!0}o.listAll=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(n["a"])({url:"".concat(r),params:{more:e},method:"get"})},o.listTree=function(){return Object(n["a"])({url:"".concat(r,"/tree_view"),method:"get"})},o.create=function(e){return Object(n["a"])({url:r,data:e,method:"post"})},o.delete=function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"delete"})},o.get=function(e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"get"})},o.update=function(e,t){return Object(n["a"])({url:"".concat(r,"/").concat(e),data:t,method:"put"})},o.concreteTree=function(e){var t={key:0,title:"top",children:[]};return i(t,e),t.children},t["a"]=o},fa25:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-tree-select",{attrs:{treeData:e.categoryTreeData,placeholder:"请选择上级目录，默认为顶级目录",treeDefaultExpandAll:"",treeDataSimpleMode:!0,allowClear:!0,value:e.categoryIdString},on:{change:e.handleSelectionChange}})},r=[],o=(a("2b45"),a("cc57"),a("163d"),{name:"CategorySelectTree",model:{prop:"categoryId",event:"change"},props:{categoryId:{type:Number,required:!0,default:0},categories:{type:Array,required:!1,default:function(){return[]}}},computed:{categoryTreeData:function(){return this.categories.map((function(e){return{id:e.id,title:e.name,value:e.id.toString(),pId:e.parentId}}))},categoryIdString:function(){return this.categoryId.toString()}},methods:{handleSelectionChange:function(e,t,a){this.$log.debug("value: ",e),this.$log.debug("label: ",t),this.$log.debug("extra: ",a),this.$emit("change",e?parseInt(e):0)}}}),i=o,l=a("9ca4"),c=Object(l["a"])(i,n,r,!1,null,null,null);t["a"]=c.exports}}]);